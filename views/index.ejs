<!DOCTYPE html><html lang="de"><head>
    <meta charset="utf-8" />
    <title>ESC Abstimmung 2025</title>
    <style>
    body{font-family:sans-serif;max-width:640px;margin:auto;padding:1rem}
    #rankList{list-style:none;padding:0;margin:0}
    .item{
      padding:.4rem .6rem;border:1px solid #ccc;margin:.2rem 0;
      border-radius:4px;display:flex;justify-content:space-between;align-items:center;
      cursor:grab;
      user-select:none;
    }
    .flag{margin-left:.25rem}
    .btn-primary {
      display:block;
      margin:2rem auto 0;
      padding:.75rem 2.5rem;
      font-size:1.15rem;
      font-weight:700;
      color:#fff;
      background:linear-gradient(135deg,#4b7bec 0%,#3867d6 100%);
      border:none;
      border-radius:9999px;
      box-shadow:0 4px 8px rgba(0,0,0,.15);
      cursor:pointer;
      transition:transform .08s ease, box-shadow .08s ease;
    }
  
    .btn-primary:hover,
    .btn-primary:focus {
      transform:translateY(-2px);
      box-shadow:0 6px 12px rgba(0,0,0,.20);
    }
  
    .btn-primary:active {
      transform:translateY(0);
      box-shadow:0 3px 6px rgba(0,0,0,.12);
    }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
    </head><body>

    
<h1>Deine Rangliste (Oben = beste Platzierung)</h1>

<form action="/vote" method="post">
  <ol id="rankList">
    <% countries.forEach(c => { %>
      <li class="item" data-country="<%= c %>">
        <%= c %> <span class="flag"><%= flags[c] %></span>
      </li>
    <% }) %>
  </ol>

  <input type="hidden" name="ranking" id="rankingField">
  <button type="submit" class="btn-primary">Abstimmen</button>
</form>

<!-- --- SCRIPTS ------------------------------------------------------ -->
<script>
const KEY      = 'escRanks';
const list     = document.getElementById('rankList');
const hidden   = document.getElementById('rankingField');

new Sortable(list, {
  animation: 150,
  onEnd: saveOrder
});

(function restore() {
  try {
    const saved = JSON.parse(localStorage.getItem(KEY)||'[]');  // [{country,rank},â€¦]
    if (saved.length) {
      const map = Object.fromEntries(saved.map(o => [o.country, true]));
      [...list.children].forEach(li => {
        const country = li.dataset.country;
        if (map[country]) list.appendChild(li);
      });
    }
  } catch(e){}
  saveOrder();
})();

function saveOrder() {
  const order = [...list.children].map((li, idx) => ({
    country: li.dataset.country,
    rank: idx + 1
  }));
  hidden.value = JSON.stringify(order);
  localStorage.setItem(KEY, hidden.value);                // persist to cache
}
</script>
</body></html>